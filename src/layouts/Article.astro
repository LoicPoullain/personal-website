---
import { formatDate } from "../utils/format-date";
import Container from "./Container.astro";
import Layout from "./Layout.astro";
import SocialLink from "./SocialLink.astro";
import TwitterLogo from "../components/logos/TwitterLogo.astro";
import LinkedInLogo from "../components/logos/LinkedInLogo.astro";
import BlueskyLogo from "../components/logos/BlueskyLogo.astro";
import EmailLogo from "../components/logos/EmailLogo.astro";
import WhatsAppLogo from "../components/logos/WhatsAppLogo.astro";
import TelegramLogo from "../components/logos/TelegramLogo.astro";
import TechNewsletterForm from "../components/newsletters/TechNewsletterForm.astro";

interface Props {
  frontmatter: {
    pubDate: string;
    title: string;
    description: string;
  }
}

const { frontmatter } = Astro.props;

const site = Astro.site;
const fullUrl = new URL(Astro.url.pathname, site).href;

const category = Astro.url.pathname.startsWith('/software-engineering') ? 'software-engineering' : Astro.url.pathname.startsWith('/entrepreneurship') ? 'entrepreneurship' : null;

const topic = category === 'software-engineering' ? 'software engineering' : 'entrepreneurship';
---

<Layout title={frontmatter.title} description={frontmatter.description}>
  <Container>
    <time datetime={frontmatter.pubDate} class="max-w-2xl mx-auto block text-sm text-center text-zinc-400 pb-6">{formatDate(frontmatter.pubDate)}</time>
    <article class="max-w-2xl mx-auto prose
    text-zinc-600
      prose-h1:font-bold prose-h1:font-serif prose-h1:tracking-wide prose-h1:text-zinc-800 prose-h1:text-4xl prose-h1:text-center
      prose-code:before:content-none prose-code:after:content-none
      prose-a:underline-offset-4 prose-a:text-inherit prose-a:font-light prose-a:hover:no-underline prose-a:hover:text-yellow-600
      leading-7">
      <slot />
    </article>
    <section class="max-w-2xl mx-auto mt-12 pt-8 border-t border-zinc-200">
      <h3 class="text-lg font-semibold text-zinc-800 mb-4 text-center">Share this article</h3>
      <div class="flex justify-center gap-4">
        <SocialLink 
          href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(frontmatter.title)}&url=${encodeURIComponent(fullUrl)}`}
          name="Share on Twitter"
        >
          <TwitterLogo />
        </SocialLink>
        <SocialLink 
          href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(fullUrl)}`}
          name="Share on LinkedIn"
        >
          <LinkedInLogo />
        </SocialLink>
        <SocialLink 
          href={`https://bsky.app/intent/compose?text=${encodeURIComponent(frontmatter.title + ' ' + fullUrl)}`}
          name="Share on Bluesky"
        >
          <BlueskyLogo />
        </SocialLink>
        <SocialLink 
          href={`mailto:?subject=${encodeURIComponent(frontmatter.title)}&body=${encodeURIComponent(`Check out this article: ${frontmatter.title} - ${fullUrl}`)}`}
          name="Share by Email"
        >
          <EmailLogo />
        </SocialLink>
        <SocialLink 
          href={`https://wa.me/?text=${encodeURIComponent(`${frontmatter.title} - ${fullUrl}`)}`}
          name="Share on WhatsApp"
        >
          <WhatsAppLogo />
        </SocialLink>
        <SocialLink 
          href={`https://t.me/share/url?url=${encodeURIComponent(fullUrl)}&text=${encodeURIComponent(frontmatter.title)}`}
          name="Share on Telegram"
        >
          <TelegramLogo />
        </SocialLink>
      </div>
    </section>
    {(category === 'software-engineering' || category === 'entrepreneurship') && (
      <section class="max-w-2xl mx-auto mt-12">
        <div class="bg-zinc-50 rounded-lg p-6 shadow-sm">
          <h3 class="text-lg font-semibold text-zinc-800 mb-2">Stay up to date</h3>
          <p class="text-sm text-zinc-600 mb-4">
            Get notified when I publish something new about <span class="font-semibold">{topic}</span>.
          </p>
          <TechNewsletterForm buttonText="Subscribe" category={category} />
        </div>
      </section>
    )}
  </Container>
</Layout>